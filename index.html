<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Proyectos KathWare</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 900px;
      margin: auto;
      padding: 2rem;
      background-color: #fff;
      color: #111;
    }

    h1, h2 {
      text-align: center;
    }

    .proyecto {
      background-color: #f0f4f8;
      border-left: 5px solid #007bff;
      padding: 1rem;
      margin-bottom: 2rem;
      border-radius: 6px;
    }

    .proyecto h3 {
      margin-top: 0;
    }

    .proyecto a {
      color: #007bff;
      text-decoration: none;
    }

    .proyecto a:hover {
      text-decoration: underline;
    }

    .markdown {
      margin-top: 1rem;
      padding: 0.5rem 1rem;
      background-color: #ffffff;
      border-left: 3px solid #aaa;
    }

    .enlace-blog {
      text-align: center;
      margin-bottom: 2rem;
      font-size: 1rem;
    }

    footer {
      text-align: center;
      margin-top: 3rem;
      font-size: 0.95rem;
      color: #333;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js"></script>
</head>
<body>

  <p class="enlace-blog">
    También podés visitar:  
    <a href="https://kathware.com.ar/proyectos/" target="_blank">Proyectos en el blog de KathWare</a>
  </p>

  <h2>Proyectos activos en GitHub</h2>
  <div id="versiones">Cargando proyectos desde GitHub...</div>

  <script>
    async function obtenerRepositorios() {
      const usuarioGitHub = "dragonmoon1522";
      const repoPrincipal = "kathware";
      const apiRepos = `https://api.github.com/users/${usuarioGitHub}/repos`;

      const converter = new showdown.Converter({ headerLevelStart: 3 });

      try {
        const respuesta = await fetch(apiRepos);
        if (!respuesta.ok) throw new Error("No se pudo obtener la lista de repositorios.");
        const repos = await respuesta.json();
        const proyectosConInfo = [];

        for (let repo of repos) {
          const baseURL = `https://raw.githubusercontent.com/${usuarioGitHub}/${repo.name}/main/`;
          const pageURL = `https://${usuarioGitHub}.github.io/${repo.name}/`;

          let readmeRaw = "", versionRaw = "", licenseRaw = "";
          let readmeHTML = "", versionHTML = "", licenseHTML = "";
          let tituloExtraido = null;
          let descripcionReducida = "";

          const archivos = {
            readme: ["README.md", "readme.md"],
            version: ["VERSION.md", "version.md"],
            license: ["LICENSE.md", "license.md"]
          };

          for (let nombre of archivos.readme) {
            try {
              const res = await fetch(baseURL + nombre);
              if (res.ok) {
                readmeRaw = await res.text();
                const lineas = readmeRaw.split("\n");
                readmeHTML = converter.makeHtml(readmeRaw);

                // Extraer título del primer ## 
                const tituloMatch = readmeRaw.match(/^##\s+(.*)/m);
                if (tituloMatch) tituloExtraido = tituloMatch[1].trim();

                // Solo para proyectos que no sean el principal
                if (repo.name !== repoPrincipal) {
                  let descripcionLines = [];
                  let inDescripcion = false;
                  for (let l of lineas) {
                    if (l.toLowerCase().includes("descripción del proyecto")) {
                      inDescripcion = true;
                      continue;
                    }
                    if (inDescripcion && l.startsWith("###")) break;
                    if (inDescripcion) descripcionLines.push(l);
                  }
                  descripcionReducida = converter.makeHtml(descripcionLines.join("\n"));
                }
                break;
              }
            } catch {}
          }

          for (let nombre of archivos.version) {
            try {
              const res = await fetch(baseURL + nombre);
              if (res.ok) {
                versionRaw = await res.text();
                const lineas = versionRaw.split("\n");
                let versionDetectada = null;
                let detalles = [];

                for (let i = 0; i < lineas.length; i++) {
                  const match = lineas[i].match(/(\d+\.\d+(\.\d+)?)/);
                  if (match && !versionDetectada) {
                    versionDetectada = match[0];
                    continue;
                  }
                  if (versionDetectada && lineas[i].trim() && !lineas[i].startsWith("---")) {
                    detalles.push(lineas[i]);
                  }
                  if (lineas[i].startsWith("## ")) break;
                }

                versionHTML = `<h4>Última versión: ${versionDetectada}</h4>` + 
                  (detalles.length > 0 ? converter.makeHtml(detalles.join("\n")) : "");
                break;
              }
            } catch {}
          }

          if (repo.name === repoPrincipal) {
            for (let nombre of archivos.license) {
              try {
                const res = await fetch(baseURL + nombre);
                if (res.ok) {
                  licenseRaw = await res.text();
                  licenseHTML = converter.makeHtml(licenseRaw);
                  break;
                }
              } catch {}
            }
          }

          proyectosConInfo.push({
            nombre: repo.name,
            titulo: tituloExtraido || repo.name.replace(/-/g, " "),
            url: pageURL,
            readme: repo.name === repoPrincipal ? readmeHTML : descripcionReducida,
            version: versionHTML,
            license: licenseHTML
          });
        }

        cargarProyectos(proyectosConInfo);
      } catch (error) {
        document.getElementById("versiones").innerText = "No se pudo cargar la lista de proyectos.";
      }
    }

    function cargarProyectos(proyectos) {
      const contenedor = document.getElementById("versiones");
      contenedor.innerHTML = "";

      proyectos.forEach(p => {
        const seccion = document.createElement("div");
        seccion.classList.add("proyecto");

        seccion.innerHTML = `
          <h3><a href="${p.url}" target="_blank">${p.titulo}</a></h3>
          ${p.readme ? `<div class="markdown">${p.readme}</div>` : ""}
          ${p.version ? `<div class="markdown">${p.version}<p><a href="${p.url}version.md" target="_blank">Ver historial completo</a></p></div>` : ""}
          ${p.license ? `<div class="markdown">${p.license}</div>` : ""}
        `;

        contenedor.appendChild(seccion);
      });
    }

    obtenerRepositorios();
  </script>

  <hr />
  <footer>
    <p>
      <a href="https://github.com/dragonmoon1522" target="_blank">Ver perfil en GitHub</a> |
      <a href="https://kathware.com.ar/contacto/" target="_blank">Contacto directo</a> |
      <a href="https://kathware.com.ar/normas-de-uso-y-licencias-de-kathware/" target="_blank">Normas de uso</a> |
      <a href="https://kathware.com.ar/lau/" target="_blank">Licencia de Accesibilidad Universal</a>
    </p>
    <p>© 2025 <strong>KathWare</strong> — hecho por Katherine Vargas</p>
  </footer>
</body>
</html>
