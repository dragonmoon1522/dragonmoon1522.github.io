<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Proyectos KathWare</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 900px;
      margin: auto;
      padding: 2rem;
      background-color: #fff;
      color: #111;
    }

    h1, h2 {
      text-align: center;
    }

    .proyecto {
      background-color: #f0f4f8;
      border-left: 5px solid #007bff;
      padding: 1rem;
      margin-bottom: 1.5rem;
      border-radius: 6px;
    }

    .proyecto h3 {
      margin-top: 0;
    }

    .proyecto p {
      margin-bottom: 0.5rem;
    }

    {
      color: #007bff;
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }

    .version-content {
      font-size: 0.95rem;
      color: #444;
    }

    .enlace-blog {
      text-align: center;
      margin-bottom: 2rem;
      font-size: 1rem;
    }
  </style>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js"></script>
</head>
<body>

    <p class="enlace-blog">
    Para ver los proyectos documentados en el blog, visitá:<br>
    <a href="https://kathware.com.ar/proyectos/" target="_blank">La página de proyectos de KathWare</a>
  </p>

  <h2>Proyectos activos en GitHub</h2>
<div id="readme-propio">Cargando introducción del proyecto actual...</div>
<hr>
<div id="versiones">Cargando proyectos desde GitHub...</div>

<script>
const usuarioGitHub = "dragonmoon1522";
const repoActual = "dragonmoon1522.github.io";

// Primero: cargar y mostrar el README + VERSION de este mismo repositorio
(async function cargarReadmePrincipal() {
  const baseURL = `https://raw.githubusercontent.com/${usuarioGitHub}/${repoActual}/main/`;

  let descripcionHTML = "<p>No se pudo cargar la descripción.</p>";
  let versionHTML = "<p>Sin información de versión disponible.</p>";

  try {
    const readmeResp = await fetch(baseURL + "README.md");
    if (readmeResp.ok) {
      const textoReadme = await readmeResp.text();
      const converter = new showdown.Converter({ headerLevelStart: 3 });
      descripcionHTML = converter.makeHtml(textoReadme);
    }
  } catch {}

  try {
    const versionResp = await fetch(baseURL + "version.md");
    if (versionResp.ok) {
      const textoVersion = await versionResp.text();
      const converter = new showdown.Converter({ headerLevelStart: 4 });
      versionHTML = converter.makeHtml(textoVersion);
    }
  } catch {}

  document.getElementById("readme-propio").innerHTML = `
    <section class="proyecto">
      ${descripcionHTML}
      ${versionHTML}
    </section>
  `;
})();
</script>

<script>
async function obtenerRepositorios() {
  const apiRepos = `https://api.github.com/users/${usuarioGitHub}/repos`;

  try {
    const respuesta = await fetch(apiRepos);
    if (!respuesta.ok) throw new Error("No se pudo obtener la lista de repositorios.");
    const repos = await respuesta.json();
    const proyectosConVersion = [];

    for (let repo of repos) {
      if (repo.name === repoActual) continue; // ⛔ Excluir el repo actual

      const repoBaseURL = `https://raw.githubusercontent.com/${usuarioGitHub}/${repo.name}/main/`;
      const repoPageURL = `https://${usuarioGitHub}.github.io/${repo.name}/`;

      const archivosRequeridos = ["readme.md", "README.md", "version.md", "VERSION.md"];
      let archivosEncontrados = new Set();

      try {
        const res = await fetch(`https://api.github.com/repos/${usuarioGitHub}/${repo.name}/contents/`);
        if (!res.ok) continue;
        const archivos = await res.json();
        archivos.forEach(f => {
          if (archivosRequeridos.includes(f.name)) {
            archivosEncontrados.add(f.name.toLowerCase());
          }
        });
      } catch { continue; }

      const tieneReadme = archivosEncontrados.has("readme.md");
      const tieneVersion = archivosEncontrados.has("version.md");
      if (!tieneReadme || !tieneVersion) continue;

      const readmeArchivo = archivosEncontrados.has("readme.md") ? "readme.md" : "README.md";
      const versionArchivo = archivosEncontrados.has("version.md") ? "version.md" : "VERSION.md";

      let descripcion = "No hay descripción disponible.";
      let ultimaVersion = "Versión desconocida";
      let detallesVersion = "Sin detalles disponibles.";

      try {
        const resReadme = await fetch(repoBaseURL + readmeArchivo);
        if (resReadme.ok) {
          const textoReadme = await resReadme.text();
          const lineas = textoReadme.split("\n");
          let descripcionArray = [];
          let capturando = false;

          for (let i = 0; i < lineas.length; i++) {
            if (lineas[i].includes("**Descripción del Proyecto**")) {
              capturando = true;
              continue;
            }
            if (capturando) {
              if (lineas[i].trim() === "---") break;
              let lineaLimpia = lineas[i].replace(/[#*]/g, "").trim();
              if (lineaLimpia) descripcionArray.push(lineaLimpia);
            }
          }
          if (descripcionArray.length > 0) {
            descripcion = descripcionArray.join(" ");
          }
        }
      } catch {}

      try {
        const resVersion = await fetch(repoBaseURL + versionArchivo);
        if (resVersion.ok) {
          const textoVersion = await resVersion.text();
          const lineasVersion = textoVersion.split("\n");

          let detalles = [];
          let capturando = false;

          for (let i = 0; i < lineasVersion.length; i++) {
            let match = lineasVersion[i].match(/(\d+\.\d+\.\d+)/);
            if (match) {
              ultimaVersion = match[0];
              capturando = true;
              continue;
            }
            if (capturando) {
              if (lineasVersion[i].trim() === "---" || lineasVersion[i].startsWith("## ")) break;
              detalles.push(lineasVersion[i].trim());
            }
          }

          const converter = new showdown.Converter({ headerLevelStart: 4 });
          detallesVersion = detalles.length > 0 ? converter.makeHtml(detalles.join("\n")) : "Sin detalles disponibles.";
        }
      } catch {}

      proyectosConVersion.push({
        nombre: repo.name.replace(/-/g, " "),
        url: repoPageURL,
        descripcion,
        ultimaVersion,
        detallesVersion
      });
    }

    renderizarProyectos(proyectosConVersion);
  } catch {
    document.getElementById("versiones").innerText = "No se pudo cargar la lista de proyectos.";
  }
}

function renderizarProyectos(lista) {
  const contenedor = document.getElementById("versiones");
  lista.forEach(proyecto => {
    const div = document.createElement("div");
    div.classList.add("proyecto");

    div.innerHTML = `
      <h3><a href="${proyecto.url}" target="_blank">${proyecto.nombre}</a></h3>
      <h4>Descripción:</h4><p>${proyecto.descripcion}</p>
      <h4>Última versión:</h4><p>${proyecto.ultimaVersion}</p>
      <div class="version-content">${proyecto.detallesVersion}</div>
    `;

    contenedor.appendChild(div);
  });
}

obtenerRepositorios();
</script>
</body>
</html>
