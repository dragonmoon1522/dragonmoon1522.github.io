<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Proyectos KathWare</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 900px;
      margin: auto;
      padding: 2rem;
      background-color: #fff;
      color: #111;
    }

    h1, h2 {
      text-align: center;
    }

    .proyecto {
      background-color: #f0f4f8;
      border-left: 5px solid #007bff;
      padding: 1rem;
      margin-bottom: 2rem;
      border-radius: 6px;
    }

    .proyecto h3 {
      margin-top: 0;
    }

    .proyecto a {
      color: #007bff;
      text-decoration: none;
    }

    .proyecto a:hover {
      text-decoration: underline;
    }

    .markdown {
      margin-top: 1rem;
      padding: 0.5rem 1rem;
      background-color: #ffffff;
      border-left: 3px solid #aaa;
    }

    .enlace-blog {
      text-align: center;
      margin-bottom: 2rem;
      font-size: 1rem;
    }

    footer {
      text-align: center;
      margin-top: 3rem;
      font-size: 0.95rem;
      color: #333;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js"></script>
</head>
<body>

  <p class="enlace-blog">
    También podés visitar:  
    <a href="https://kathware.com.ar/proyectos/" target="_blank">Proyectos en el blog de KathWare</a>
  </p>

  <h2>Proyectos activos en GitHub</h2>
  <div id="versiones">Cargando proyectos desde GitHub...</div>

  <script>
  async function obtenerRepositorios() {
    const usuarioGitHub = "dragonmoon1522";
    const repoPrincipal = "kathware";
    const apiRepos = `https://api.github.com/users/${usuarioGitHub}/repos`;
    const converter = new showdown.Converter({ flavor: 'github', headerLevelStart: 3 });

    try {
      const respuesta = await fetch(apiRepos);
      if (!respuesta.ok) throw new Error("No se pudo obtener la lista de repositorios.");
      const repos = await respuesta.json();
      const proyectos = [];

      for (let repo of repos) {
        const baseURL = `https://raw.githubusercontent.com/${usuarioGitHub}/${repo.name}/main/`;
        const pagina = `https://${usuarioGitHub}.github.io/${repo.name}/`;

        let readme = "", version = "", license = "", titulo = "", descripcion = "";

        // Traer README
        try {
          const resp = await fetch(baseURL + "README.md");
          if (resp.ok) {
            const texto = await resp.text();
            readme = converter.makeHtml(texto);
            // Extraer título real del proyecto
            const tituloMatch = texto.match(/^#\s+(.*)/);
            if (tituloMatch) titulo = tituloMatch[1].trim();

            // Extraer bloque de descripción
            const descStart = texto.indexOf("### Descripción del Proyecto");
            if (descStart !== -1) {
              const subTexto = texto.slice(descStart);
              const match = subTexto.match(/### Descripción del Proyecto\s+(.*?)\n###/s);
              if (match && match[1]) {
                descripcion = converter.makeHtml(match[1].trim());
              }
            }
          }
        } catch {}

        // Traer VERSION
        try {
          const resp = await fetch(baseURL + "version.md");
          if (resp.ok) {
            const texto = await resp.text();
            const secciones = texto.split(/##\s+/).filter(v => v.trim().length > 0);
            if (secciones.length > 0) {
              const primera = secciones[0].split("---")[0].trim();
              version = converter.makeHtml("## Última versión\n\n" + primera);
            }
          }
        } catch {}

        // Traer LICENSE (solo para el repo principal)
        if (repo.name === repoPrincipal) {
          try {
            const resp = await fetch(baseURL + "license.md");
            if (resp.ok) {
              const texto = await resp.text();
              license = converter.makeHtml(texto);
            }
          } catch {}
        }

        // Decidir qué mostrar
        if (repo.name === repoPrincipal) {
          proyectos.unshift({
            titulo: titulo || "KathWare — Núcleo del ecosistema",
            url: pagina,
            readme,
            version,
            license
          });
        } else {
          proyectos.push({
            titulo: titulo || repo.name.replace(/-/g, " "),
            url: pagina,
            descripcion,
            version
          });
        }
      }

      renderizarProyectos(proyectos);
    } catch (error) {
      document.getElementById("versiones").innerText = "Error al cargar proyectos.";
    }
  }

  function renderizarProyectos(proyectos) {
    const contenedor = document.getElementById("versiones");
    contenedor.innerHTML = "";

    proyectos.forEach(proy => {
      const div = document.createElement("div");
      div.className = "proyecto";

      div.innerHTML = `
        <h3><a href="${proy.url}" target="_blank">${proy.titulo}</a></h3>
        ${proy.readme ? `<div class="markdown">${proy.readme}</div>` : ""}
        ${proy.descripcion ? `<div class="markdown">${proy.descripcion}</div>` : ""}
        ${proy.version ? `<div class="markdown">${proy.version}</div>` : ""}
        ${proy.license ? `<div class="markdown">${proy.license}</div>` : ""}
      `;

      contenedor.appendChild(div);
    });
  }

  obtenerRepositorios();
</script>

<hr />
  <footer>
    <p>
      <a href="https://github.com/dragonmoon1522" target="_blank">Ver perfil en GitHub</a> |
      <a href="https://kathware.com.ar/contacto/" target="_blank">Contacto directo</a> |
      <a href="https://kathware.com.ar/normas-de-uso-y-licencias-de-kathware/" target="_blank">Normas de uso</a> |
      <a href="https://kathware.com.ar/lau/" target="_blank">Licencia de Accesibilidad Universal</a>
    </p>
    <p>© 2025 <strong>KathWare</strong> — hecho por Katherine Vargas</p>
  </footer>
</body>
</html>
