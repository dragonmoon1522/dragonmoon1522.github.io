<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Proyectos KathWare</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 900px;
      margin: auto;
      padding: 2rem;
      background-color: #fff;
      color: #111;
    }

    h1, h2 {
      text-align: center;
    }

    .proyecto {
      background-color: #f0f4f8;
      border-left: 5px solid #007bff;
      padding: 1rem;
      margin-bottom: 1.5rem;
      border-radius: 6px;
    }

    .proyecto h3 {
      margin-top: 0;
    }

    .proyecto p {
      margin-bottom: 0.5rem;
    }

    a {
      color: #007bff;
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }

    .version-content {
      font-size: 0.95rem;
      color: #444;
    }

    .enlace-blog {
      text-align: center;
      margin-bottom: 2rem;
      font-size: 1rem;
    }

    footer {
      text-align: center;
      margin-top: 2rem;
      font-size: 0.95rem;
      color: #333;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js"></script>
</head>
<body>

  <p class="enlace-blog">
    Para ver los proyectos documentados en el blog, visitá:<br>
    <a href="https://kathware.com.ar/proyectos/" target="_blank">La página de proyectos de KathWare</a>
  </p>

  <h2>Proyectos activos en GitHub</h2>
  <div id="versiones">Cargando proyectos desde GitHub...</div>

  <script>
    async function obtenerRepositorios() {
      const usuarioGitHub = "dragonmoon1522";
      const repoPrincipal = "kathware";
      const apiRepos = `https://api.github.com/users/${usuarioGitHub}/repos`;

      try {
        const respuesta = await fetch(apiRepos);
        if (!respuesta.ok) throw new Error("No se pudo obtener la lista de repositorios.");
        const repos = await respuesta.json();
        const proyectosConVersion = [];

        for (let repo of repos) {
          const repoBaseURL = `https://raw.githubusercontent.com/${usuarioGitHub}/${repo.name}/main/`;
          const repoPageURL = `https://${usuarioGitHub}.github.io/${repo.name}/`;

          const archivosRequeridos = ["readme.md", "README.md", "version.md", "VERSION.md"];
          let archivosEncontrados = new Set();

          const repoContentsURL = `https://api.github.com/repos/${usuarioGitHub}/${repo.name}/contents/`;
          try {
            const repoContentsResp = await fetch(repoContentsURL);
            if (repoContentsResp.ok) {
              const archivos = await repoContentsResp.json();
              archivos.forEach(archivo => {
                const nombreArchivo = archivo.name;
                if (archivosRequeridos.includes(nombreArchivo)) {
                  archivosEncontrados.add(nombreArchivo.toLowerCase());
                }
              });
            }
          } catch {
            continue;
          }

          const tieneReadme = archivosEncontrados.has("readme.md");
          const tieneVersion = archivosEncontrados.has("version.md");

          if (!tieneReadme && !tieneVersion) continue;

          const readmeArchivo = archivosEncontrados.has("readme.md") ? "readme.md" : "README.md";
          const versionArchivo = archivosEncontrados.has("version.md") ? "version.md" : "VERSION.md";

          let descripcion = "No hay descripción disponible.";
          let ultimaVersion = "Versión desconocida";
          let detallesVersion = "Sin detalles disponibles.";

          if (tieneReadme) {
            try {
              const readmeRespuesta = await fetch(repoBaseURL + readmeArchivo);
              if (readmeRespuesta.ok) {
                const textoReadme = await readmeRespuesta.text();
                const lineas = textoReadme.split("\n");
                let descripcionArray = [];
                let capturando = false;

                for (let i = 0; i < lineas.length; i++) {
                  const linea = lineas[i];
                  if (linea.toLowerCase().includes("descripción del proyecto")) {
                    capturando = true;
                    continue;
                  }
                  if (capturando) {
                    if (linea.trim().startsWith("###") || linea.trim() === "---") break;
                    let limpia = linea.replace(/[#*]/g, "").trim();
                    if (limpia) descripcionArray.push(limpia);
                  }
                }

                if (descripcionArray.length > 0) {
                  descripcion = descripcionArray.join(" ");
                }
              }
            } catch {}
          }

          if (tieneVersion) {
            try {
              const versionRespuesta = await fetch(repoBaseURL + versionArchivo);
              if (versionRespuesta.ok) {
                const textoVersion = await versionRespuesta.text();
                const lineas = textoVersion.split("\n");

                let detalles = [];
                let capturando = false;

                for (let i = 0; i < lineas.length; i++) {
                  let match = lineas[i].match(/(\d+\.\d+\.\d+)/);
                  if (match) {
                    ultimaVersion = match[0];
                    capturando = true;
                    continue;
                  }
                  if (capturando) {
                    if (lineas[i].trim() === "---" || lineas[i].startsWith("## ")) break;
                    detalles.push(lineas[i].trim());
                  }
                }

                const converter = new showdown.Converter({ headerLevelStart: 4 });
                detallesVersion = detalles.length > 0 ? converter.makeHtml(detalles.join("\n")) : "Sin detalles disponibles.";
              }
            } catch {}
          }

          // Excluir mostrar el version.md completo si es el repo principal
          if (repo.name === repoPrincipal) {
            proyectosConVersion.unshift({
              nombre: "KathWare — Núcleo del ecosistema",
              url: `https://${usuarioGitHub}.github.io/${repo.name}/`,
              descripcion: descripcion,
              ultimaVersion: ultimaVersion,
              detallesVersion: detallesVersion
            });
          } else {
            proyectosConVersion.push({
              nombre: repo.name.replace(/-/g, " "),
              url: repoPageURL,
              descripcion: descripcion,
              ultimaVersion: ultimaVersion,
              detallesVersion: detallesVersion
            });
          }
        }

        cargarProyectos(proyectosConVersion);
      } catch (error) {
        document.getElementById("versiones").innerText = "No se pudo cargar la lista de proyectos.";
      }
    }

    function cargarProyectos(proyectos) {
      const contenedor = document.getElementById("versiones");
      proyectos.forEach(proyecto => {
        const seccion = document.createElement("div");
        seccion.classList.add("proyecto");

        seccion.innerHTML = `
          <h3><a href="${proyecto.url}" target="_blank">${proyecto.nombre}</a></h3>
          <h4><strong>Descripción:</strong></h4>
          <p>${proyecto.descripcion}</p>
          <h4><strong>Última versión:</strong> ${proyecto.ultimaVersion}</h4>
          <div class="version-content">${proyecto.detallesVersion}</div>
        `;
        contenedor.appendChild(seccion);
      });
    }

    obtenerRepositorios();
  </script>

  <hr />
  <footer>
    <p>
      <a href="https://github.com/dragonmoon1522" target="_blank">Ver perfil en GitHub</a> |
      <a href="https://kathware.com.ar/contacto/" target="_blank">Contacto directo</a> |
      <a href="https://kathware.com.ar/normas-de-uso-y-licencias-de-kathware/" target="_blank">Normas de uso</a> |
      <a href="https://kathware.com.ar/lau/" target="_blank">Licencia de Accesibilidad Universal</a>
    </p>
    <p>© 2025 <strong>KathWare</strong> — hecho por Katherine Vargas</p>
  </footer>
</body>
</html>
