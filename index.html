<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Proyectos KathWare</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 900px;
      margin: auto;
      padding: 2rem;
      background-color: #fff;
      color: #111;
    }

    h1, h2 {
      text-align: center;
    }

    .proyecto {
      background-color: #f0f4f8;
      border-left: 5px solid #007bff;
      padding: 1rem;
      margin-bottom: 1.5rem;
      border-radius: 6px;
    }

    .proyecto h3, .proyecto h2 {
      margin-top: 0;
    }

    .proyecto p {
      margin-bottom: 0.5rem;
    }

    a {
      color: #007bff;
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }

    .version-content {
      font-size: 0.95rem;
      color: #444;
    }
  </style>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js"></script>
</head>
<body>

  <h1>üöÄ Portafolio de Proyectos KathWare</h1>

  <h2>üìù Proyectos publicados en el blog</h2>
  <div id="kathware-posts">Cargando proyectos desde el blog...</div>

  <h2>üíª Proyectos activos en GitHub</h2>
  <div id="versiones">Cargando proyectos desde GitHub...</div>

  <!-- üîπ Cargar proyectos desde el RSS del blog -->
  <script>
    const rssURL = "https://kathware.com.ar/category/proyectos/feed/";

    fetch(rssURL)
      .then(response => response.text())
      .then(str => new window.DOMParser().parseFromString(str, "text/xml"))
      .then(data => {
        const items = data.querySelectorAll("item");
        const contenedor = document.getElementById("kathware-posts");
        contenedor.innerHTML = "";

        items.forEach(item => {
          const titulo = item.querySelector("title").textContent;
          const link = item.querySelector("link").textContent;
          const descripcion = item.querySelector("description").textContent;

          const div = document.createElement("div");
          div.classList.add("proyecto");

          div.innerHTML = `
            <h3><a href="${link}" target="_blank" rel="noopener noreferrer">${titulo}</a></h3>
            <p>${descripcion}</p>
          `;

          contenedor.appendChild(div);
        });
      })
      .catch(() => {
        document.getElementById("kathware-posts").innerText = "No se pudo cargar el contenido del blog.";
      });
  </script>

  <!-- üîπ Cargar proyectos desde GitHub -->
  <script>
    async function obtenerRepositorios() {
      const usuarioGitHub = "dragonmoon1522";
      const apiRepos = `https://api.github.com/users/${usuarioGitHub}/repos`;

      try {
        const respuesta = await fetch(apiRepos);
        if (!respuesta.ok) throw new Error("No se pudo obtener la lista de repositorios.");
        const repos = await respuesta.json();
        const proyectosConVersion = [];

        for (let repo of repos) {
          const repoBaseURL = `https://raw.githubusercontent.com/${usuarioGitHub}/${repo.name}/main/`;
          const repoPageURL = `https://${usuarioGitHub}.github.io/${repo.name}/`;

          const archivosRequeridos = ["readme.md", "README.md", "version.md", "VERSION.md"];
          let archivosEncontrados = new Set();

          const repoContentsURL = `https://api.github.com/repos/${usuarioGitHub}/${repo.name}/contents/`;
          try {
            const repoContentsResp = await fetch(repoContentsURL);
            if (repoContentsResp.ok) {
              const archivos = await repoContentsResp.json();
              archivos.forEach(archivo => {
                const nombreArchivo = archivo.name;
                if (archivosRequeridos.includes(nombreArchivo)) {
                  archivosEncontrados.add(nombreArchivo.toLowerCase());
                }
              });
            }
          } catch {
            continue;
          }

          const tieneReadme = archivosEncontrados.has("readme.md");
          const tieneVersion = archivosEncontrados.has("version.md");

          if (!tieneReadme || !tieneVersion) continue;

          const readmeArchivo = archivosEncontrados.has("readme.md") ? "readme.md" : "README.md";
          const versionArchivo = archivosEncontrados.has("version.md") ? "version.md" : "VERSION.md";

          let descripcion = "No hay descripci√≥n disponible.";
          let ultimaVersion = "Versi√≥n desconocida";
          let detallesVersion = "Sin detalles disponibles.";

          try {
            const readmeRespuesta = await fetch(repoBaseURL + readmeArchivo);
            if (readmeRespuesta.ok) {
              const textoReadme = await readmeRespuesta.text();
              const lineas = textoReadme.split("\n");
              let descripcionArray = [];
              let capturando = false;

              for (let i = 0; i < lineas.length; i++) {
                if (lineas[i].includes("üìå **Descripci√≥n del Proyecto**")) {
                  capturando = true;
                  continue;
                }
                if (capturando) {
                  if (lineas[i].trim() === "---") break;
                  let lineaLimpia = lineas[i].replace(/[#*]/g, "").trim();
                  if (lineaLimpia) descripcionArray.push(lineaLimpia);
                }
              }
              if (descripcionArray.length > 0) {
                descripcion = descripcionArray.join(" ");
              }
            }
          } catch {}

          try {
            const versionRespuesta = await fetch(repoBaseURL + versionArchivo);
            if (versionRespuesta.ok) {
              const textoVersion = await versionRespuesta.text();
              const lineasVersion = textoVersion.split("\n");

              let detalles = [];
              let capturando = false;

              for (let i = 0; i < lineasVersion.length; i++) {
                let match = lineasVersion[i].match(/(\d+\.\d+\.\d+)/);
                if (match) {
                  ultimaVersion = match[0];
                  capturando = true;
                  continue;
                }
                if (capturando) {
                  if (lineasVersion[i].trim() === "---" || lineasVersion[i].startsWith("## ")) break;
                  detalles.push(lineasVersion[i].trim());
                }
              }

              const converter = new showdown.Converter();
              detallesVersion = detalles.length > 0 ? converter.makeHtml(detalles.join("\n")) : "Sin detalles disponibles.";
            }
          } catch {}

          proyectosConVersion.push({
            nombre: repo.name.replace(/-/g, " "),
            url: repoPageURL,
            descripcion: descripcion,
            ultimaVersion: ultimaVersion,
            detallesVersion: detallesVersion
          });
        }

        cargarProyectos(proyectosConVersion);
      } catch (error) {
        document.getElementById("versiones").innerText = "No se pudo cargar la lista de proyectos.";
      }
    }

    function cargarProyectos(proyectos) {
      const contenedor = document.getElementById("versiones");
      proyectos.forEach(proyecto => {
        const seccion = document.createElement("div");
        seccion.classList.add("proyecto");

        seccion.innerHTML = `
          <h3><a href="${proyecto.url}" target="_blank">${proyecto.nombre}</a></h3>
          <p><strong>Descripci√≥n:</strong> ${proyecto.descripcion}</p>
          <p><strong>√öltima versi√≥n:</strong> ${proyecto.ultimaVersion}</p>
          <div class="version-content">${proyecto.detallesVersion}</div>
        `;
        contenedor.appendChild(seccion);
      });
    }

    obtenerRepositorios();
  </script>
<hr>
<footer style="text-align: center; margin-top: 2rem; font-size: 0.95rem;">
  <p>üîó <a href="https://kathware.com.ar/contacto/" target="_blank" rel="noopener noreferrer">Contacto directo</a> | 
     <a href="https://kathware.com.ar/normas-de-uso-y-licencias-de-kathware/" target="_blank">Normas de uso</a> | 
     <a href="https://kathware.com.ar/lau/" target="_blank">Licencia de Accesibilidad Universal</a>
  </p>
  <p>¬© 2025 <strong>KathWare</strong> ‚Äî hecho por Katherine Vargas</p>
</footer>

</body>
</html>
